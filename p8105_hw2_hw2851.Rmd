---
title: "p8105_hw2_hw2851"
output: github_document
---

```{r setup, include=FALSE}
library("tidyverse")
library("readxl")
```

## Problem 1

```{r trash_wheel, message=FALSE}
trash_wheel_data_set = './data/Trash-Wheel-Collection-Totals-8-6-19.xlsx'
mr_trash_wheel_data = read_excel(trash_wheel_data_set) %>%
  janitor::clean_names() %>%
  # remove columns containing notes
  select(dumpster:homes_powered) %>%
  # remove rows that don't contain dumpster-specific data (for example, "May Total")
  filter(!stringr::str_detect(month, "Total")) %>%
  # round the number of sports balls
  mutate(sports_balls = round(sports_balls, 0))
```
The Mr. trash wheel dataset has `r nrow(mr_trash_wheel_data)` rows. After clean up, it contains `r length(mr_trash_wheel_data)` columns: `r colnames(mr_trash_wheel_data)`. Here is the first row of the dataset: `r head(mr_trash_wheel_data, n=1)`. Here is the last row of the dataset: `r tail(mr_trash_wheel_data, n=1)`.
The median number of sports balls in a dumpster in 2019 is `r median(filter(mr_trash_wheel_data, year == 2019)$sports_balls)`.

```{r}
precipitation_2019_data = read_excel(trash_wheel_data_set, sheet="2019 Precipitation", skip=1) %>%
  janitor::clean_names() %>%
  drop_na() %>%
  mutate(year = "2019")

precipitation_2018_data = read_excel(trash_wheel_data_set, sheet="2018 Precipitation", skip=1) %>%
  janitor::clean_names() %>%
  drop_na() %>%
  mutate(year = "2018")

precipitation_data = bind_rows(precipitation_2019_data, precipitation_2018_data) %>%
  mutate(month = month.name[month])
```

The 2018 and 2019 combined precipitation dataset has `r nrow(precipitation_data)` rows. After clean up, it contains `r length(precipitation_data)` columns: `r colnames(precipitation_data)`. Here is the first row of the dataset: `r head(precipitation_data, n=1)`. Here is the last row of the dataset: `r tail(precipitation_data, n=1)`. The total precipitation in 2018 is `r sum(filter(precipitation_data, year == 2018)$total)`.

## Problem 2
```{r, message=FALSE}
pols_month_data = read_csv('./data/fivethirtyeight_datasets/pols-month.csv') %>%
  separate(mon, into = c("year", "month", "day"), sep = "-") %>%
  mutate(year = as.numeric(year), month = month.name[as.integer(month)]) %>%
  mutate(president = ifelse(prez_gop==0, "dem", "gop")) %>%
  select(-day, -prez_dem, -prez_gop)
```

```{r, message=FALSE}
snp_data = read_csv('./data/fivethirtyeight_datasets/snp.csv') %>%
  separate(date, into=c("month", "day", "year"), sep="/") %>%
  mutate(year = as.integer(year), month = as.integer(month)) %>%
  mutate(year = ifelse(year < 20, year + 2000, year + 1900)) %>%
  arrange(year, month) %>%
  mutate(month = month.name[month]) %>%
  relocate(year, month) %>%
  select(-day)
```

```{r, message=FALSE}
unemployment_data = read_csv('./data/fivethirtyeight_datasets/unemployment.csv') %>%
  rename(year=Year) %>%
  pivot_longer(!year, names_to = "month", values_to = "unemployment_rate")
```

```{r}
merged_538_data = left_join(pols_month_data, snp_data, by = c("year" = "year", "month" = "month")) %>%
  mutate(month_short = substr(month, 1, 3)) %>%
  left_join(unemployment_data, by = c("year" = "year", "month_short" = "month")) %>%
  select(-month_short)
```

After processing, the merged FiveThirtyEight dataset has `r nrow(merged_538_data)` rows and `r length(merged_538_data)` columns. The `r length(merged_538_data)` columns are: `r colnames(merged_538_data)`.

Here is the first row of the dataset: `r head(merged_538_data, n=1)`. Here is the last row of the tdataset: `r tail(merged_538_data, n=1)`. The range of years is from `r range(merged_538_data$year)[1]` to `r range(merged_538_data$year)[2]`.

The closing values of the S&P stock index is available since 1950 though, and the unemployment rate is available since 1948. The mean of S&P closing value is `r mean(drop_na(merged_538_data)$close)`. The mean of unemployment rate is `r mean(drop_na(merged_538_data)$unemployment_rate)`.
## Problem 3